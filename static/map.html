<html>
    

    <body>
        <div id="container" style="height: 100%; width: 100%;"></div>
    </body>
    
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
    <script src="./datamaps.world.hires.min.js"></script>
    <script>
let committees = []
let temp = []
var data;
fetch('.api/allocations?c=disec', requestOptions)
    .then((response) => response.json())
    .then((result) => {data_update(result)})
    .catch((error) => console.log('error', error));
function data_update(x){
    committees = x["data"]
    committees.forEach(element => {
        element['fillKey'] = "available"
    });
}


    var map = new Datamap({fill:"#ffffff",element: document.getElementById('container'),projection: 'mercator',
    geographyConfig: {
        borderColor:"#3f4f5e",
        popupTemplate: function(geography, data) { //this function should just return a string
          if (!data.delegate){return ""}
          return '<div class="hoverinfo" style="font-family: \'Plus Jakarta Sans\', sans-serif;font-weight:600">' + geography.properties.name + " - " + data.delegate +  '</div>';
        }
  },fills: {
      defaultFill: '#D0BEA8',
      available:"#be965b"
    },});
    
    class map_handler{
        constructor(){
            //Data loading and what not here
            this.data = {
                "SC":{
                    USA: {
                        delegate:"Joe Biden",
                        fillkey:"available"
                    },
                    CAN:{
                        delegate:"Srinivas Confetti",
                        fillKey:"available"
                    },
                    HUN:{
                        delegate:"hungry guy",
                        fillkey:"available"
                    }
                },
                "DISEC":{
                    USA: {
                        delegate:"deez nuts"
                    },
                    CAN: '#0fa0fa'
                }
            }
        }
        data_update(x){
            console.log(x)
            console.log(map)
            map.updateChoropleth(this.data[x],{reset:true});
        }
        
    }

    handler = new map_handler()

    window.addEventListener("message", (event) => {
            handler.data_update(event.data)
        });
    </script>

</html>